<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <script>
      // Apply dark mode immediately before content renders
      const theme = localStorage.getItem("theme");
      if (theme === "dark") {
        document.documentElement.classList.add("dark-mode");
      }
    </script>

    <link rel="stylesheet" href="/css/style.css" />
    <title>Club Management</title>
  </head>
  <body>
    <div class="container mt-4"><%- include("../includes/flash") %></div>
    <nav class="navbar bg-body-tertiary">
        <% if(user && user.role != "student") {%>
          <a href="/logout">
          <div class="button-container flex gap-4 items-center">
            <button class="Btn">
              <div class="sign">
                <svg viewBox="0 0 512 512">
                  <path
                    d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"
                  ></path>
                </svg>
              </div>

              <div class="button-text">Logout</div>
            </button>
        </a>
          <% } %>

        <!-- Toggle Button -->
        <!-- <label class="theme-toggle">
          <input type="checkbox" id="theme-checkbox" />
          <span class="toggle-icon">
            <i class="bi bi-sun"></i>
            <i class="bi bi-moon"></i>
          </span>
        </label>
        <label for="profile-icon">
          <i class="bi bi-person-circle"></i>
        </label> -->
        <% if( user && user.role == "student") {%>
          <div class="profile-section">
        <div class="profile-icon" onclick="toggleDropdown()">
          <%= user && user.studentName ?
          user.studentName.charAt(0).toUpperCase() : 'U' %>
        </div>

        <div class="profile-dropdown" id="profileDropdown">
          <div class="profile-header">
            <div class="avatar">
              <%= user && user.studentName ?
              user.studentName.charAt(0).toUpperCase() : 'U' %>
            </div>
            <div class="profile-info text-break">
              <span
                ><%= user && user.studentName ? user.studentName : 'Guest'
                %></span
              >
              <small><%= user && user.email ? user.email : 'No email' %></small>
            </div>
          </div>
          <a href="/edit-profile" class="dropdown-link">Edit Profile</a>
          <a href="/event-registrations" class="dropdown-link"
            >Event Registrations</a
          >
          <a href="/logout" class="dropdown-link logout-btn">Sign Out</a>
        </div>
      </div>
          <% } %>
      </div>
    </nav>
    <script
      type="text/javascript"
      src="https://cdn.emailjs.com/dist/email.min.js"
    ></script>
    <script type="text/javascript">
      (function () {
        emailjs.init("TYe4ysqnBvnZ7Fe5w"); // from EmailJS dashboard
      })();
    </script>

    <script>
      async function sendOTP(email, otp) {
        const params = {
          to_email: email,
          to_name: "User", // optional
          otp: otp,
        };

        try {
          const res = await emailjs.send(
            "service18",
            "template_occsvqa",
            params
          );
          console.log("OTP sent!", res.status, res.text);
        } catch (err) {
          console.error("Failed to send OTP", err);
        }
      }
    </script>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script src="../../public/js/app.js"></script>

    <!-- <script>
      document.addEventListener("DOMContentLoaded", () => {
        const checkbox = document.getElementById("theme-checkbox");
        if (!checkbox) return;

        // Set initial toggle position
        const theme = localStorage.getItem("theme") || "light";
        checkbox.checked = theme === "dark";

        // Apply dark mode class
        document.body.classList.toggle("dark-mode", theme === "dark");

        // Toggle event listener
        checkbox.addEventListener("change", () => {
          const isDark = checkbox.checked;
          document.body.classList.toggle("dark-mode", isDark);
          localStorage.setItem("theme", isDark ? "dark" : "light");
        });
      });
    </script> -->
    <script>
      (() => {
    "use strict";
    const forms = document.querySelectorAll(".needs-validation");
    Array.from(forms).forEach((form) => {
      form.addEventListener(
        "submit",
        (event) => {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add("was-validated");
        },
        false
      );
    });
  })();
    </script>

    <script>
      function toggleDropdown() {
    const dropdown = document.getElementById("profileDropdown");
    dropdown.classList.toggle("show");
  }

  document.addEventListener("click", function (e) {
    const dropdown = document.getElementById("profileDropdown");
    const icon = document.querySelector(".profile-icon");
    if (!dropdown.contains(e.target) && !icon.contains(e.target)) {
      dropdown.classList.remove("show");
    }
  });
    </script>
  </body>
</html>
